**ACID** - это набор требований к транзакционной системе, обеспечивающий наиболее надёжную и предсказуемую её работу — атомарность, согласованность, изоляцию, устойчивость; сформулированы в конце 1970-х годов Джимом Греем.

![[ACID.png]]

## Атомарность (Atomicity)

Атомарность означает, что транзакция должна выполнятся целиком, либо вообще не выполняться. Название происходит от такого свойства атома, как неделимость.

**Пример:**

*Допустим, требуется провести перевод денег со счета 1 на счет 2, самая простая реализация на [[Базы данных/SQL/SQL|SQL]]:*

```SQL
UPDATE balances SET amount = amount - 100 WHERE id = 1;
---- Возможная ошибка
UPDATE balances SET amount = amount + 100 WHERE id = 2;
```

*При этом, если произойдет какая-либо ошибка между двумя запросами, то деньги спишутся со счета 1, но не придут на счет 2. Чтобы исправить эту проблему, нужно использовать транзакцию:*

```SQL
BEGIN; 
UPDATE balances SET amount = amount - 100 WHERE id = 1;
---- Возможная ошибка, тогда произойдет 
UPDATE balances SET amount = amount + 100 WHERE id = 2;
COMMIT; -- ROLLBACK, если требуется сохранить изменения
```

Теперь соблюдается принцип атомарности и если по какой-либо причине не выполнится второй запрос, то предыдущая операция откатится.

## Консистентность (Consistency)

Консистентность означает, что данные после транзакции должны соответствовать требованиям (иметь тот же тип, что указан, и подходить под ограничения).

**Пример:**

*Допустим, имеется таблица:*

| Поле  | Тип     | Ограничения |
| ----- | ------- | ----------- |
| id    | Serial  | Primary Key |
| value | Integer | >= 0        |

Если попытаться создать строку, с `value` меньшим 0, то произойдет ошибка, так как БД сохраняет принцип консистентности.

## Изоляция (Isolation)

Изоляция означает, что несколько транзакций могут выполняться параллельно, при этом не зависеть друг от друга.

**Существует несколько уровней изоляции:**

1. `READ COMMITED` (По умолчанию) - позволяет читать только те данные, которые были добавлены при помощи `COMMIT` после успешной транзакции.

2. `REPEATABLE READ` - делает снимок базы данных после первого запроса, что позволяет читать достоверные данные, даже если между операциями произошел `COMMIT`.

3. `SERIALIZABLE` - база данных самостоятельно определяет аномалии в работе транзакций.

## Долговечность (Durability)

Долговечность означает, что после окончания транзакции данные должны записаться на жесткий диск и в случае какого-либо сбоя, данные останутся в базе и никуда не пропадут.